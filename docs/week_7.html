<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Learning Diary - CASA0023 - 7&nbsp; Week 7 - Classification I</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./week_8.html" rel="next">
<link href="./week_6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week_7.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week 7 - Classification I</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Learning Diary - CASA0023</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Week 1 - An Introduction to Remotely Sensing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">week_2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3 - Remotely Sensed Data Corrections and Data joining and Enhancement</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 - The Policy of ‘Arable Land Minimum’ in Shanghai</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 5</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 6 - Intro to GEE</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_7.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week 7 - Classification I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Week 8 - Classification II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Week 9 - Synthetic Aperture Radar (SAR)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary"><span class="header-section-number">7.1</span> 7.1 Summary</a>
  <ul class="collapse">
  <li><a href="#review-of-how-classified-data-is-used" id="toc-review-of-how-classified-data-is-used" class="nav-link" data-scroll-target="#review-of-how-classified-data-is-used"><span class="header-section-number">7.1.1</span> 7.1.1 Review of how classified data is used:</a></li>
  <li><a href="#how-to-classify-remotely-sensed-data" id="toc-how-to-classify-remotely-sensed-data" class="nav-link" data-scroll-target="#how-to-classify-remotely-sensed-data"><span class="header-section-number">7.1.2</span> 7.1.2 How to classify remotely sensed data</a></li>
  <li><a href="#practical" id="toc-practical" class="nav-link" data-scroll-target="#practical"><span class="header-section-number">7.1.3</span> 7.1.3 Practical</a></li>
  </ul></li>
  <li><a href="#application" id="toc-application" class="nav-link" data-scroll-target="#application"><span class="header-section-number">7.2</span> 7.2 Application</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection"><span class="header-section-number">7.3</span> 7.3 Reflection</a></li>
  <li><a href="#reference-list" id="toc-reference-list" class="nav-link" data-scroll-target="#reference-list"><span class="header-section-number">7.4</span> 7.4 Reference list</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week 7 - Classification I</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="summary" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="summary"><span class="header-section-number">7.1</span> 7.1 Summary</h2>
<section id="review-of-how-classified-data-is-used" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="review-of-how-classified-data-is-used"><span class="header-section-number">7.1.1</span> 7.1.1 Review of how classified data is used:</h3>
<p>The following mind map summarises the application areas of classified data that were covered in the lecture and summarises some data that is available for classified research or sensors that are the source of these classified data in their respective fields:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wk7/how_classified_data_is_used.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>how classified data is used</p>
</section>
<section id="how-to-classify-remotely-sensed-data" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="how-to-classify-remotely-sensed-data"><span class="header-section-number">7.1.2</span> 7.1.2 How to classify remotely sensed data</h3>
<p>Classification methods for remotely sensed data could be divided into unsupervised and supervised classification, more specifically see the mind map below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wk7/Classification_methods.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The mind map of classification methods for remotely sensed data</p>
<p><strong>For the summary of key concepts covered in the lecture:</strong></p>
<ul>
<li><p><strong>Classification and regression trees (CART):</strong></p>
<ul>
<li>Classification and regression trees (CART) are a machine learning technique used to divide data into two or more discrete categories or to predict continuous variables. CART builds decision trees by recursively splitting the dataset into purer or less variable subsets. The evaluation of CART classification outcomes can be conducted by calculating the Gini impurity of leaves, with lower Gini impurity indicating better classification performance and purer leaves. (Avoid overfitting!)</li>
</ul></li>
<li><p><strong>Random Forests:</strong></p>
<ul>
<li>Random Forest classification is an ensemble learning method that enhances classification accuracy by building multiple decision trees and combining their predictions. The accuracy of Random Forest classification is commonly evaluated using the Out-of-Bag (OOB) error rate, with a lower OOB error indicating higher predictive accuracy.</li>
</ul></li>
<li><p><strong>Maximum Likelihood:</strong></p>
<ul>
<li>Maximum likelihood is a classification approach based on probability that determines the classification of each pixel by calculating its probability of belonging to various land cover types. It employs a multivariate normal distribution function to process image data, choosing the category with the highest probability as the pixel’s classification. This method allows for the consideration of prior probability information, although such information is often unavailable.</li>
</ul></li>
<li><p><strong>Support Vector Machines (SVM):</strong></p>
<ul>
<li>It is a binary linear classifier that categorises data by maximizing the margin between two classes of training data. When data are not linearly separable, SVM employs the kernel trick to find the optimal separating hyperplane by transforming the data into a higher dimensional space. The choice of parameters, such as C and Gamma, significantly impacts the model’s performance and is typically determined through grid search for optimal values.</li>
</ul></li>
</ul>
</section>
<section id="practical" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="practical"><span class="header-section-number">7.1.3</span> 7.1.3 Practical</h3>
<p>This week’s practical focused on classifying surface features using remote sensing data, including how to load and process Global Administrative Unit Layers (GAUL) data, and how to apply supervised learning methods for information extraction. Specifically, it explored using CART and Random Forest classifiers to classify Sentinel-2 satellite data of the Shenzhen area, and further discussed the classification accuracy assessment and the error matrix.</p>
<p><strong>In the following section, I will mainly focus on summarising what I have been doing within Practical in terms of focusing on CART and Random Forest Classification:</strong></p>
<p>Image data after clipping using GEE (to enable comparison of classification results later on, so added to the learning diary):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wk7/the_image_of_Shenzhen_after_clipping.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Shenzhen Remotely Sensed Image</p>
<p>In the initial labelling of the training samples, I labelled too many pixel points beyond what GEE was running at so it produced errors. Therefore the number of labelled points must not exceed the maximum of 5000 pixel points required by Google. Later on, some of my labelled pixels were too few resulting in inaccurate classification results. Therefore, it is important to have the appropriate amount of labelled sample pixels.</p>
<p>This is an image of the CART classification result where I just began to have a significant error due to including too few pixels in the labelled samples:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wk7/result_of_CART_first.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The image of the CART classification results (with relatively large errors)</p>
<p>Finally, the result obtained from the CART classification after I added some more labelled pixels is much better when comparing the result with the clipping Shenzhen satellite image mentioned in the previous section and the result of the first CART classification:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wk7/result_of_CART.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The image of the CART classification results (much better one)</p>
<p>The following image is the result of random forest classification. When we compare it with the cropped Shenzhen satellite image and all the results obtained from the previous CART classification, we could find that the results obtained from the Random Forest classification look the best to naked eyes (e.g., the classification for water is better and so on):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wk7/result_using_Random_Forest_classifier.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The image of the Random Forest classification results</p>
<p><strong>Accuracy assessment for the randomised forest classification result:</strong></p>
<ul>
<li><p><strong>Random Forest Out of Bag (OOB) Error Estimate:</strong></p>
<p>The Out of Bag (OOB) Error Estimate serves as a prediction error metric for random forest. This estimate is calculated using the data not employed in the training of each decision tree within the ensemble, known as the OOB sample. Through predicting outcomes with this data, the overall error rate is derived. In this specific case, the OOB error estimate is reported to be 0.007407407407407408, implying an extremely accurate prediction capability of the random forest classifier, closely aligning with a high accuracy level.</p></li>
<li><p><strong>Resubstitution Accuracy:</strong></p>
<p>Resubstitution accuracy is assessed by comparing the original training dataset with the model’s predictions. This accuracy metric reflects the model’s capability to correctly predict the outcomes of the data on which it was trained. Here, the resubstitution accuracy is 100%, indicating that the model perfectly predicts the training data outcomes.</p></li>
<li><p><strong>Confusion Matrix and Validation Accuracy:</strong></p>
<p>The confusion matrix is a crucial tool for assessing a classification model’s performance on a dataset where the true values are known. It contrasts the actual target values with the model’s predictions, providing insights into both the accuracy and the types of errors the model makes. The validation accuracy derived from the confusion matrix in this analysis is 97.35449735449735%. This high accuracy level demonstrates the model’s effectiveness on the validation dataset, which was not used in its training. Additionally, the consumer accuracy detailed in the confusion matrix validates the model’s high predictive performance across various classes, with values such as 1 for several classes and 0.9393939393939394 and 0.8928571428571429 for others, reflecting nuanced predictive capabilities.</p></li>
</ul>
</section>
</section>
<section id="application" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="application"><span class="header-section-number">7.2</span> 7.2 Application</h2>
<p><strong>The following is the research on the use of CART classification in the GEE platform:</strong></p>
<ul>
<li><p>Pande <em>et al.</em> (2024) use the Classification and Regression Tree (CART) model in combination with the Google Earth Engine (GEE) to assess the impact of winter season’s land cover and change detection mapping on evapotranspiration (crop water requirement) parameters. It finds that using the CART model alongside GEE’s cloud computing proves to be an effective approach for precise land cover classification and change detection mapping, enabling the creation of pixel-based information for the study area during winter seasons (Pande <em>et al.</em>, 2024).</p></li>
<li><p>The <strong>advantage</strong> of using the Classification and Regression Tree (CART) for land cover classification and change detection lies in its ability to handle complex datasets by recursively partitioning the input space based on predictive variables, creating a decision tree structure suitable for analyzing land cover dynamics. However, a <strong>limitation</strong> of the CART model is its potential for overfitting, especially in scenarios involving large and complex datasets.</p></li>
</ul>
<p><strong>The following is the research using Random Forest Classification on the GEE platform:</strong></p>
<ul>
<li><p>Noi Phan <em>et al.</em> (2020) utilized the Random Forest (RF) classifier and Google Earth Engine (GEE) to investigate the impact of image composition methods on land cover classification accuracy. It shows that the choice of image composition strategies significantly affects accuracy, with the highest accuracy achieved by the summer season (June to September) time series datasets (Noi Phan <em>et al.</em>, 2020). The <strong>advantages</strong> of using Random Forest for land cover classification include its robustness to noise and outliers, ability to handle high-dimensional and multi-source datasets, and generally higher accuracy compared to other popular classifiers such as SVM, kNN, or MLC (Noi Phan <em>et al.</em>, 2020). <strong>Despite</strong> having fewer parameters compared to other machine learning algorithms, tuning parameters such as the number of trees (ntree) and the number of features to consider at each split (mtry) is still necessary. Inappropriate parameter settings may affect the model’s performance and generalizability.</p></li>
<li><p>Tassi <em>et al.</em> (2021) compared pixel-based (PB) and object-based (OB) approaches using Random Forest classification algorithm on Landsat 8 data in Google Earth Engine (GEE) for land cover classification in Maiella National Park, central Italy. By integrating Gray-Level Co-occurrence Matrix (GLCM) texture information and utilizing the L8 panchromatic band to enhance segmentation steps, a 15-meter resolution Land Use/Land Cover (LULC) map was produced, showing better performance with the object-based approach when incorporating the panchromatic band (Tassi <em>et al.</em>, 2021). The <strong>advantage</strong> of using Random Forest is its non-parametric nature, ability to handle high dimensionality, and avoidance of overfitting (Tassi <em>et al.</em>, 2021). However, its <strong>limitation</strong> lies in being a black box model with unclear decision tree splitting rules. GEE platform offers the capability to process and analyze vast geospatial information, but its limitations might include the complexity of processing and analysis, requiring a high level of technical knowledge and experience.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wk7/Application_RF.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>‘Flowchart of the methodology’ (Tassi <em>et al.</em>, 2021)</p>
</section>
<section id="reflection" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="reflection"><span class="header-section-number">7.3</span> 7.3 Reflection</h2>
<p>Through this week’s lecture and practical I reviewed the two broad categories of supervised and unsupervised classification, and also learnt about CART, which is a classification method that I had never come across before. Actually, Random Forest Classification was used by myself in my undergraduate dissertation, so I have some familiarity with it. However, I learnt this method through independent study at that time, and my understanding of this method has been further deepened in this module after the teacher’s explanation and review in class.</p>
<p>I have to be impressed once again with the power of GEE’s functionality. The use of the GEE platform offers the benefit of powerful remote sensing and geospatial analysis capabilities, efficiently facilitating large-scale assessments of land cover and change detection studies. For example, in this week’s practical, using CART and Random Forest to classify the land cover in GEE and reading the literature to classify the use of land cover using different classification methods on the GEE platform, and so on, all of which made me feel the strong computing power of GEE.</p>
</section>
<section id="reference-list" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="reference-list"><span class="header-section-number">7.4</span> 7.4 Reference list</h2>
<p>Noi Phan, T., Kuch, V., and Lehnert, L. (2020) Land cover classification using google earth engine and random forest classifier-the role of image composition. <em>Remote sensing (Basel, Switzerland)</em>. [Online] 12 (15), 2411-. DOI: 10.3390/RS12152411.</p>
<p>Pande, C. B. et al.&nbsp;(2024) Impact of land use/land cover changes on evapotranspiration and model accuracy using Google Earth engine and classification and regression tree modeling. <em>Geomatics, natural hazards and risk</em>. [Online] 15 (1), . DOI: 10.1080/19475705.2023.2290350.</p>
<p>Tassi, A., Gigante, D., Modica, G., Di Martino, L., and Vizzari, M. (2021) Pixel-vs.&nbsp;Object-based landsat 8 data classification in google earth engine using random forest: The case study of maiella national park. <em>Remote sensing (Basel, Switzerland)</em>. [Online] 13 (12), 2299-. DOI: 10.3390/rs13122299.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./week_6.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 6 - Intro to GEE</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./week_8.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Week 8 - Classification II</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>